<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
  <ModulePrefs title="Carousel" height="100">
  	<Require feature="dynamic-height"/> 
  </ModulePrefs>
  <UserPref name="siteDomain" display_name="Site Domain" datatype="string" required="true"/>
  <UserPref name="siteName" display_name="Site Name" datatype="string" required="true"/>
  <UserPref name="siteRoot" display_name="Site Root" datatype="string" required="true"/>
  
  <Content type="html">
     <![CDATA[
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="https://abvasvmc.github.io/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://abvasvmc.github.io/home.css">
		
		<script src="https://abvasvmc.github.io/js/jquery.min.js"></script>
		<script src="https://abvasvmc.github.io/js/bootstrap.min.js"></script>
		<script src="https://abvasvmc.github.io/js/moment.js"></script>
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
		<script src="https://abvasvmc.github.io/abva.js"></script>
	  
		<script type="text/javascript">
			//Site Specific Configuration
			//===========================
			var siteDomain = null;
			var siteName = null;
			var siteRoot = null;
			
			//var siteDomain = "abva.org";
			//var siteName = "www3";
		</script>

		<div class="container-fluid">
			<div class="row">
				<div class="col-md-6">
					<div class="inner">
						<div id="myCarousel" class="carousel slide" data-ride="carousel">
						</div>
						<div id="myWelcome">
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<div class="visible-sm"><br /></div>
					<div class="row">
						<div class="inner">
<!--							<div  class="col-sm-12" id="follow-us-panel">
								<div class="feed-panel-heading">Stay Tuned</div>
								Follow us on <a href="https://www.facebook.com/groups/ABVA.SVMC/" target="_top">Facebook</a> or 
								<a id="signup-sheet-link" href="#" target="_top">sign up</a> for the program mailing list.
							</div>
-->							
							<div id="myEventsfeed" class="col-sm-6">
							</div>
							<div id="myNewsfeed" class="col-sm-6">
							</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script type="text/javascript">
		
			//Initialize feed loader
			google.load("feeds", "1");
			
			//Page initialization routine. This is called by google.setOnLoadCallback callback
			function initialize(feedUrlSeed) {
				
				//Getting user prefs
				var prefs = new gadgets.Prefs();
				siteDomain = prefs.getString("siteDomain");
				siteName = prefs.getString("siteName");
				siteRoot = prefs.getString("siteRoot");
			
				//Signup sheet link
				$("#signup-sheet-link").attr("href", siteRoot + "/sign-up");

				//Loading carousel images
				var aspectRatio = 9.0/16;
				showCarouselImages("/carousel-data", "myCarousel", feedUrlSeed, aspectRatio)

				//Loading welcome message from the Welcome page
				showPageContents("/welcome", "myWelcome", feedUrlSeed);
				
				//Loading Special Events feed
				showAnnouncements("/events", "myEventsfeed", "Special Events", feedUrlSeed);
				
				//Loading News feed
				showAnnouncements("/news", "myNewsfeed", "News", feedUrlSeed);
				
				////gadgets.window.adjustHeight();
			} //End: function initialize()
			

			//Calling initialization routing on page loading
			$(document).ready(function () {
				
				initialize(Math.floor((Math.random() * 100000)));
			});			
			
			gadgets.util.registerOnLoadHandler(function() { 
				gadgets.window.adjustHeight();
		   });
		   
		   //Resize listener for gadget resizing on layout changes
		   var prevWindowWidth= -1;
		   var carousel_aspect_ratio = -1;
		   var prevSwitchedWidth = -1;
		   $( window ).resize(function() {
		        if(prevWindowWidth < 0){
		        	prevWindowWidth = $(window).width();
		        	prevSwitchedWidth = prevWindowWidth;
		        	carousel_aspect_ratio = $("#myCarousel").width() / $("#myCarousel").height()
		        }
		        else{
		        	var w = $(window).width();
		        	var resize_required = (prevWindowWidth >= 768 && w < 768) ||
		        						  (prevWindowWidth < 768 && w >= 768) ||
		        						  (prevWindowWidth >= 992 && w < 992) ||
		        						  (prevWindowWidth < 992 && w >= 992) | 
		        						  (prevWindowWidth <= w - 20) ||
		        						  (prevWindowWidth >= w+20);

		        	if(resize_required){
		        		gadgets.window.adjustHeight();
		        		prevSwitchedWidth = w;
		        	}
		        	
		        	if(carousel_aspect_ratio > 0){
		        		var new_carousel_height = $("#myCarousel").width() / carousel_aspect_ratio;
		        		$("#myCarousel").height(new_carousel_height)
		        	}
		        	
		        	//gadgets.window.adjustHeight();
		        	prevWindowWidth = w;					  
		        }
		    });	
						
		</script>
     ]]>
  </Content> 
</Module>